<main class="cadastro-page">
  <div class="cadastro-container">
    <img src="assets/carp.jpg" class="bg-carpa" alt="carpa" />
    <h2>Editar Evento #{{ eventId }}</h2>

    <form [formGroup]="form" (ngSubmit)="efetuarAtualizacao()">
      <p class="section-label"><em>Imagem do Evento</em></p>
      <div class="form-grid full-width preview-container">
        <div>
          <img *ngIf="previewUrl" [src]="previewUrl" class="image-preview" alt="Prévia do evento" />
        </div>
      </div>

      <div class="form-grid full-width">
        <button mat-stroked-button type="button" class="upload-btn" (click)="fileInput.click()">
          <mat-icon>upload</mat-icon>
          Selecionar Nova Imagem
        </button>
        <input #fileInput type="file" accept="image/*" (change)="onFileChange($event)" hidden />
        <mat-error *ngIf="form.get('imagemUrl')?.hasError('required') && !previewUrl">A imagem é obrigatória.</mat-error>
      </div>

      <p class="section-label"><em>Informações do Evento</em></p>
      <div class="form-grid">
        <mat-form-field appearance="fill">
          <mat-label>Nome do Evento</mat-label>
          <input matInput formControlName="nome" />
           <mat-error *ngIf="form.get('nome')?.hasError('required')">O nome do evento é obrigatório.</mat-error>
           <mat-error *ngIf="form.get('nome')?.hasError('maxlength')">O nome não pode exceder 150 caracteres.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Local</mat-label>
          <input type="text" matInput formControlName="local" [matAutocomplete]="auto">
          <mat-autocomplete #auto="matAutocomplete">
            <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
              {{option}}
            </mat-option>
          </mat-autocomplete>
           <mat-error *ngIf="form.get('local')?.hasError('required')">O local é obrigatório.</mat-error>
           <mat-error *ngIf="form.get('local')?.hasError('maxlength')">O local não pode exceder 150 caracteres.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Data de Início (dd/mm/yyyy)</mat-label>
          <input matInput [matDatepicker]="pickerInicio" formControlName="dataInicio">
          <mat-datepicker-toggle matSuffix [for]="pickerInicio"></mat-datepicker-toggle>
          <mat-datepicker #pickerInicio></mat-datepicker>
           <mat-error *ngIf="form.get('dataInicio')?.hasError('required')">A data de início é obrigatória.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Data de Término (dd/mm/yyyy)</mat-label>
          <input matInput [matDatepicker]="pickerFinal" formControlName="dataFinal">
          <mat-datepicker-toggle matSuffix [for]="pickerFinal"></mat-datepicker-toggle>
          <mat-datepicker #pickerFinal></mat-datepicker>
          <mat-error *ngIf="form.get('dataFinal')?.hasError('required')">A data de término é obrigatória.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Horário de Início</mat-label>
          <input matInput formControlName="horarioInicio" type="time" />
           <mat-error *ngIf="form.get('horarioInicio')?.hasError('required')">O horário de início é obrigatório.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Horário de Término</mat-label>
          <input matInput formControlName="horarioFinal" type="time" />
          <mat-error *ngIf="form.get('horarioFinal')?.hasError('required')">O horário de término é obrigatório.</mat-error>
        </mat-form-field>

        <mat-form-field appearance="fill" class="full-width">
          <mat-label>Descrição</mat-label>
          <textarea matInput formControlName="descricao"></textarea>
          <mat-error *ngIf="form.get('descricao')?.hasError('required')">A descrição é obrigatória.</mat-error>
           <mat-error *ngIf="form.get('descricao')?.hasError('maxlength')">A descrição não pode exceder 1000 caracteres.</mat-error>
        </mat-form-field>
      </div>

      <div class="btns-bottom">
        <button mat-stroked-button class="btn-cancel" routerLink="/list-events">
          <mat-icon>close</mat-icon>
          <span>Cancelar</span>
        </button>
        <button mat-stroked-button class="btn-submit" type="submit" [disabled]="form.invalid || isLoading">
          <mat-icon>radio_button_unchecked</mat-icon>
          <span *ngIf="!isLoading">Salvar Alterações</span>
          <span *ngIf="isLoading">Salvando...</span>
        </button>
      </div>
    </form>
  </div>
</main>